<!DOCTYPE html>
<html>
  <head>
    <title>Question 1</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
 
<script>    if (sessionStorage.getItem('userinfo') == null) {
        window.location.replace("login.html");
       };
</script>
  </head>
  <body>

<div id="main">


</div>
            <button type="button" class="btn btn-primary" id="submit">submit</button>
      


     <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVHCSIgYfsYUdCjpevjf00e0RsOyAAvDY&callback=initMap"
    async defer></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/markerwithlabel.js"></script>

    <script>
      var scenario=-1;
      
      $(document).ready(function() {
      

        var uinfo=sessionStorage.getItem('userinfo');
        var myObject = JSON.parse(uinfo);

         $.ajax({
                   url: 'http://localhost:3000/questions',
                   dataType: 'json',
                   type: 'GET',
                   async: false,
                   headers: { 'Authorization' : myObject.auth_token       },
                   contentType: 'application/json; charset=utf-8'
               
                }).done(function(data) {
             //  alert(JSON.stringify(data));
               
                  $.each(data, function(index) {
                  //  alert(data[index].id);
                    if (data[index].id<=13)
                    $("#main").append("<form  id='q"+data[index].id + "'>" + 
                    data[index].id + "-" + data[index].name +"</form>");
                   
                  });
                })
                  .fail(function(msg) {
                  alert("failed");
                             
                  });
                  
                   $.ajax({
                   url: 'http://localhost:3000/answers',
                   dataType: 'json',
                   type: 'GET',
                   async: false,
                   headers: { 'Authorization' : myObject.auth_token       },
                   contentType: 'application/json; charset=utf-8'
               
                }).done(function(data) {

               
                  $.each(data, function(index) {
                //  alert(JSON.stringify(data[index]));
                    if (data[index].question_id<=13)
                    $("#q"+data[index].question_id).append("<div id='"+ data[index].question_id +
                    "_" + data[index].answer_id + "' " +                    
                     "class='radio'><label><input required type='radio' name='optradio' value='" + data[index].answer_id+ "'>" + 
                    data[index].answer + "</label></div>");
                  });
                })
                  .fail(function(msg) {
                  alert("failed");
                             
                  });                  
                  
                  
         $('#submit').click(function() {
   
            if ($('input[name=optradio]:checked').length!=13) 
                {
                  alert('please answer all questions');
                  return;                
                };
                 
            var hr=0;
            var salaryin=$('input[name=optradio]:checked', '#q4').val();
            if ( salaryin==1) hr= 10000/2080;
            if ( salaryin==2) hr= 24000/2080;
            if ( salaryin==3) hr= 49000/2080;
            if ( salaryin==4) hr= 99000/2080;
            if ( salaryin==5) hr= 149000/2080;
            if ( salaryin>5 ) hr= 200000/2080;   
              $.ajax({
                  url: 'http://localhost:3000/users',
                     dataType: 'json',
		               async : false,
                     type: 'PUT',
                     contentType: 'application/json; charset=utf-8',
                     headers: { 'Authorization' : myObject.auth_token ,  "X-HTTP-Method-Override": "PUT"    },
                     data: JSON.stringify({ "loginbefore": 1,"hrrate":hr}) 
          }).done(function(msg) {
                 //  alert( JSON.stringify(msg));
                    window.location = 'main.html';
                   
    		 })
          .fail(function(msg) {
                    alert("fail");
          });  
          
      

       });                  
                     
      });
    </script>
   
    
  </body>
</html>
