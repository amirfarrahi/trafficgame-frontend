<!DOCTYPE html>
<html>
  <head>
    <title>Survey Part 1</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/bootstrap.min.css" />
 
<script>    if (sessionStorage.getItem('userinfo') == null) {
        window.location.replace("login.html");
       };
</script>
  </head>
  <body>

<div id="main" class="col-md-12">



</div>
<div class="col-md-12">           
            <button type="button" class="btn btn-primary" id="submit">submit</button>
      
</div>

     <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVHCSIgYfsYUdCjpevjf00e0RsOyAAvDY&callback=initMap"
    async defer></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" 
 crossorigin="anonymous"></script>

    <script>
      var scenario=-1;
      
      $(document).ready(function() {
      

        var uinfo=sessionStorage.getItem('userinfo');
        var myObject = JSON.parse(uinfo);

         $.ajax({
                   url: 'https://mighty-inlet-46722.herokuapp.com/questions',
                   dataType: 'json',
                   type: 'GET',
                   async: false,
                   headers: { 'Authorization' : myObject.auth_token       },
                   contentType: 'application/json; charset=utf-8'
               
                }).done(function(data) {
             //  alert(JSON.stringify(data));
               
                  $.each(data, function(index) {
                  //  alert(data[index].id);
                    if (data[index].id<=13)
                    $("#main").append("<form id='q"+data[index].id + "'><h3><span class='label label-info'>" + 
                    data[index].id + "-" + data[index].name +"</span></h3></form>");
                   
                  });
                })
                  .fail(function(msg) {
                  alert("failed");
                             
                  });
                  
                   $.ajax({
                   url: 'https://mighty-inlet-46722.herokuapp.com/answers',
                   dataType: 'json',
                   type: 'GET',
                   async: false,
                   headers: { 'Authorization' : myObject.auth_token       },
                   contentType: 'application/json; charset=utf-8'
               
                }).done(function(data) {

               
                  $.each(data, function(index) {
                //  alert(JSON.stringify(data[index]));
                    if (data[index].question_id<=13)
                    $("#q"+data[index].question_id).append("<div id='"+ data[index].question_id +
                    "_" + data[index].answer_id + "' " +                    
                     "class='radio'><h4><label><input  required type='radio' name='optradio' value='" + data[index].answer_id+ "'>" + 
                    data[index].answer + "</label></h4></div>");
                  });
                })
                  .fail(function(msg) {
                  alert("failed");
                             
                  });                  
                  
                  
         $('#submit').click(function() {
   
            if ($('input[name=optradio]:checked').length!=13) 
                {
                  alert('please answer all questions');
                  return;                
                };
                 
            var hr=0;
            var salaryin=$('input[name=optradio]:checked', '#q4').val();
            if ( salaryin==1) hr= 10000/2080;
            if ( salaryin==2) hr= 24000/2080;
            if ( salaryin==3) hr= 49000/2080;
            if ( salaryin==4) hr= 99000/2080;
            if ( salaryin==5) hr= 149000/2080;
            if ( salaryin>5 ) hr= 200000/2080;   
              $.ajax({
                  url: 'https://mighty-inlet-46722.herokuapp.com/users',
                     dataType: 'json',
		               async : false,
                     type: 'PUT',
                     contentType: 'application/json; charset=utf-8',
                     headers: { 'Authorization' : myObject.auth_token ,  "X-HTTP-Method-Override": "PUT"    },
                     data: JSON.stringify({ "loginbefore": 1,"hrrate":hr}) 
          }).done(function(msg) {
                 //  alert( JSON.stringify(msg));
                    window.location = 'main.html';
                   
    		 })
          .fail(function(msg) {
                    alert("fail");
          });  
          
      

       });                  
                     
      });
    </script>
   
    
  </body>
</html>
